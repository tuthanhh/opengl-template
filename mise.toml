[tools]
cmake = "latest"
python = "latest"
ninja = "latest"

[env]
BUILD_DIR = "build"
PROJECT_NAME = "opengl-template"
_.python.venv = { path = ".venv", create = true, uv_create_args = ["--seed"] }

[tasks.setup]
description = "Install required Python packages for GLAD"
run = ".venv/bin/pip install jinja2"

# --- Configuration Tasks ---
[tasks."configure:debug"]
description = "Generate Debug build files"
sources = ["CMakeLists.txt"]
outputs = ["{{env.BUILD_DIR}}/debug/build.ninja"]
depends = ["setup"]
run = "cmake -B {{env.BUILD_DIR}}/debug -G Ninja -DCMAKE_BUILD_TYPE=Debug"

[tasks."configure:release"]
description = "Generate Release build files"
sources = ["CMakeLists.txt"]
outputs = ["{{env.BUILD_DIR}}/release/build.ninja"]
depends = ["setup"]
run = "cmake -B {{env.BUILD_DIR}}/release -G Ninja -DCMAKE_BUILD_TYPE=Release"

# --- Build Tasks ---
[tasks.build]
alias = "b"
description = "Build the project (defaults to debug)"
depends = ["configure:debug"]
sources = ["src/**/*", "CMakeLists.txt"]
run = "cmake --build {{env.BUILD_DIR}}/debug"

[tasks."build:release"]
description = "Build in release mode"
depends = ["configure:release", "configure:debug"]
sources = ["src/**/*", "CMakeLists.txt"]
run = "cmake --build {{env.BUILD_DIR}}/release"

# --- Run Tasks ---
[tasks.run]
alias = "r"
description = "Build and run (Debug)"
depends = ["build"]
run = ["cmake --build {{env.BUILD_DIR}}/debug --target run"]

[tasks."run:release"]
description = "Build and run (Release)"
depends = ["build:release"]
# Fixed: pointed this to the release directory
run = ["cmake --build {{env.BUILD_DIR}}/release --target run"]

[tasks.clean]
description = "Remove the build directory"
run = "cmake -E remove_directory {{env.BUILD_DIR}}"
